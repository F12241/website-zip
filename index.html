<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Login & Dashboard</title>

<style>
  body { 
    font-family: Arial, sans-serif; 
    background:#6A0DAD; /* UNGU CERAH */
    color:white; 
    margin:0; 
  }

  /* CARD LOGIN */
  .center { 
    max-width:420px; 
    margin:90px auto; 
    background:#7A1CCF; /* UNGU LEBIH MUDA */
    padding:30px; 
    border-radius:18px; 
    box-shadow:0 0 15px rgba(0,0,0,0.3);
  }

  input,button { 
    width:100%; 
    padding:12px; 
    border:none; 
    border-radius:10px; 
    margin-top:12px; 
    font-size:15px; 
  }

  input { 
    background:#ffffff; 
    color:black;
  }

  button { 
    background:#B300FF; /* UNGU PINK CERAH */
    color:white; 
    cursor:pointer; 
    font-weight:600;
  }

  button:hover { opacity:0.85; }

  /* DASHBOARD */
  #dashboard {
    display:none; 
    padding:20px;
  }

  .box {
    background:#7A1CCF; /* UNGU MUDA */
    padding:20px; 
    border-radius:15px; 
    margin-bottom:20px;
    box-shadow:0 0 10px rgba(0,0,0,0.25);
  }

  textarea {
    width:100%; 
    height:260px; 
    margin-top:10px; 
    border-radius:10px; 
    padding:10px;
    background:white;
    color:black;
    font-size:14px;
  }

  h2,h3 { margin-top:0; }

</style>
</head>
<body>

<div class="center" id="loginBox">
  <h2 style="text-align:center;">Login</h2>
  <input id="user" placeholder="Username">
  <input id="pass" placeholder="Password" type="password">
  <button onclick="login()">Masuk</button>
</div>

<div id="dashboard">
  <h2 id="roleTitle"></h2>

  <div id="adminPanel" style="display:none;">
    <div class="box">
      <h3>Tambah User</h3>
      <input id="newUser" placeholder="Username baru">
      <input id="newPass" placeholder="Password baru" type="password">
      <button onclick="addUser()">Tambah User</button>
    </div>

    <div class="box">
      <h3>Copy Web to HTML</h3>
      <input id="urlAdmin" placeholder="https://example.com">
      <button onclick="copyHTML('admin')">Ambil HTML</button>
      <textarea id="outAdmin"></textarea>
      <button onclick="salinKode('admin')">Salin Kode</button>
    </div>
  </div>

  <div id="userPanel" style="display:none;">
    <div class="box">
      <h3>Copy Web to HTML</h3>
      <input id="urlUser" placeholder="https://example.com">
      <button onclick="copyHTML('user')">Ambil HTML</button>
      <textarea id="outUser"></textarea>
      <button onclick="salinKode('user')">Salin Kode</button>
    </div>
  </div>

</div>

<script>
if(!localStorage.users){
  localStorage.users = JSON.stringify([
    {user:"admin", pass:"admin123", role:"admin"}
  ]);
}

function login(){
  let u = user.value.trim();
  let p = pass.value.trim();
  let db = JSON.parse(localStorage.users);
  let acc = db.find(x=>x.user===u && x.pass===p);

  if(!acc){ alert("Login gagal"); return; }

  loginBox.style.display='none';
  dashboard.style.display='block';
  roleTitle.innerHTML = "Dashboard: "+acc.role.toUpperCase();

  if(acc.role === 'admin'){
    adminPanel.style.display='block';
  } else {
    userPanel.style.display='block';
  }
}

function addUser(){
  let u = newUser.value.trim();
  let p = newPass.value.trim();
  if(!u || !p){ alert("Isi username & password"); return; }

  let db = JSON.parse(localStorage.users);
  db.push({user:u, pass:p, role:"user"});
  localStorage.users = JSON.stringify(db);

  alert("User berhasil ditambahkan!");
  newUser.value="";
  newPass.value="";
}

async function copyHTML(mode){
  let url = mode==='admin' ? urlAdmin.value : urlUser.value;
  let output = mode==='admin' ? outAdmin : outUser;

  try{
    const res = await fetch('/proxy?url='+encodeURIComponent(url));
    const text = await res.text();
    output.value = text;
  }catch(err){
    output.value = "Gagal mengambil HTML.";
  }
}

function salinKode(mode){
  let textarea = mode==='admin' ? outAdmin : outUser;

  textarea.select();
  textarea.setSelectionRange(0, 99999);

  navigator.clipboard.writeText(textarea.value)
    .then(()=>alert("Kode berhasil disalin!"))
    .catch(()=>alert("Gagal menyalin."));
}
</script>

</body>
  </html>
